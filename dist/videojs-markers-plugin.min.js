/*! videojs-markers-plugin - v1.0.3 - 2019-10-09
* Copyright (c) 2019 ; Licensed  */

!function(e,r){if("function"==typeof define&&define.amd)define(["video.js"],r);else if("undefined"!=typeof exports)r(require("video.js"));else{r(e.videojs),e.videojsMarkersPlugin={}}}(this,function(e){"use strict";var r,x=(r=e)&&r.__esModule?r:{default:r};var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return"Break: "+e.text},time:function(e){return e.time}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(e){},onMarkerReached:function(e,r){},markers:[]};function g(e){var r,t={top:0,bottom:0,left:0,width:0,height:0,right:0};try{r=e.getBoundingClientRect()}catch(e){r=t}return r}var j=-1;x.default.registerPlugin("markers",function(a){if(!x.default.mergeOptions){var o=function(e){return!!e&&"object"===(void 0===e?"undefined":b(e))&&"[object Object]"===toString.call(e)&&e.constructor===Object};x.default.mergeOptions=function i(e,r){var n={};return[e,r].forEach(function(t){t&&Object.keys(t).forEach(function(e){var r=t[e];o(r)?(o(n[e])||(n[e]={}),n[e]=i(n[e],r)):n[e]=r})}),n}}x.default.dom.createEl||(x.default.dom.createEl=function(e,r,t){var i=x.default.Player.prototype.dom.createEl(e,r);return t&&Object.keys(t).forEach(function(e){i.setAttribute(e,t[e])}),i});var l=x.default.mergeOptions(T,a),n={},u=[],c=j,d=this,f=null,s=null,m=j;function r(){u.sort(function(e,r){return l.markerTip.time(e)-l.markerTip.time(r)})}function t(e){e.forEach(function(e){e.key=function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)})}(),d.el().querySelector(".vjs-progress-holder").appendChild(function(i){var e=x.default.dom.createEl("div",{},{"data-marker-key":i.key,"data-marker-time":l.markerTip.time(i)});k(i,e),e.addEventListener("click",function(e){var r=!1;if("function"==typeof l.onMarkerClick&&(r=!1===l.onMarkerClick(i)),!r){var t=this.getAttribute("data-marker-key");d.currentTime(l.markerTip.time(n[t]))}}),l.markerTip.display&&function(i){i.addEventListener("mouseover",function(){var e=n[i.getAttribute("data-marker-key")];if(f){l.markerTip.html?f.querySelector(".vjs-tip-inner").innerHTML=l.markerTip.html(e):f.querySelector(".vjs-tip-inner").innerText=l.markerTip.text(e),f.style.left=v(e)+"%";var r=g(f),t=g(i);f.style.marginLeft=-parseFloat(r.width/2)+parseFloat(t.width/4)+"px",f.style.visibility="visible"}}),i.addEventListener("mouseout",function(){f&&(f.style.visibility="hidden")})}(e);return e}(e)),n[e.key]=e,u.push(e)}),r()}function v(e){var r=d.liveTracker.isLive()&&d.duration()===1/0?d.liveTracker.seekableEnd():d.duration();return r===1/0&&(r=d.liveTracker.liveCurrentTime()),l.markerTip.time(e)/r*100}function k(e,r){r.className="vjs-marker "+(e.class||""),Object.keys(l.markerStyle).forEach(function(e){r.style[e]=l.markerStyle[e]});var t=e.time/d.duration();if((t<0||1<t)&&(r.style.display="none"),r.style.left=v(e)+"%",e.duration)r.style.width=e.duration/d.duration()*100+"%",r.style.marginLeft="0px";else{var i=g(r);r.style.marginLeft=i.width/2+"px"}}function i(i){u.forEach(function(e){var r=d.el().querySelector(".vjs-marker[data-marker-key='"+e.key+"']"),t=l.markerTip.time(e);!i&&r.getAttribute("data-marker-time")===t||(k(e,r),r.setAttribute("data-marker-time",t))}),r()}function y(e){s&&(m=j,s.style.visibility="hidden"),c=j;var i=[];e.forEach(function(e){var r=u[e];if(r){delete n[r.key],i.push(e);var t=d.el().querySelector(".vjs-marker[data-marker-key='"+r.key+"']");t&&t.parentNode.removeChild(t)}}),i.reverse(),i.forEach(function(e){u.splice(e,1)}),r()}function e(){if(l.breakOverlay.display&&!(c<0)){var e=d.currentTime(),r=u[c],t=l.markerTip.time(r);t<=e&&e<=t+l.breakOverlay.displayTime?(m!==c&&(m=c,s&&(s.querySelector(".vjs-break-overlay-text").innerHTML=l.breakOverlay.text(r))),s&&(s.style.visibility="visible")):(m=j,s&&(s.style.visibility="hidden"))}}function p(){!function(){if(!u.length)return;function e(e){return e<u.length-1?l.markerTip.time(u[e+1]):d.duration()}var r=d.currentTime(),t=j;if(c!==j){var i=e(c);if(r>=l.markerTip.time(u[c])&&r<i)return;if(c===u.length-1&&r===d.duration())return}if(r<l.markerTip.time(u[0]))t=j;else for(var n=0;n<u.length;n++)if(i=e(n),r>=l.markerTip.time(u[n])&&r<i){t=n;break}t!==c&&(t!==j&&a.onMarkerReached&&a.onMarkerReached(u[t],t),c=t)}(),e(),a.onTimeUpdateAfterMarkerUpdate&&a.onTimeUpdateAfterMarkerUpdate()}function h(){l.markerTip.display&&(f=x.default.dom.createEl("div",{className:"vjs-tip",innerHTML:"<div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div>"}),d.el().querySelector(".vjs-progress-holder").appendChild(f)),d.markers.removeAll(),t(l.markers),l.breakOverlay.display&&(s=x.default.dom.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(l.breakOverlay.style).forEach(function(e){s&&(s.style[e]=l.breakOverlay.style[e])}),d.el().appendChild(s),m=j),p(),d.on("timeupdate",p),d.off("loadedmetadata")}d.on("loadedmetadata",function(){h()}),d.on("seekableendchange",function(){i(!0)}),d.on("seeked",function(){i(!0)}),d.markers={getMarkers:function(){return u},next:function(){for(var e=d.currentTime(),r=0;r<u.length;r++){var t=l.markerTip.time(u[r]);if(e<t){d.currentTime(t);break}}},prev:function(){for(var e=d.currentTime(),r=u.length-1;0<=r;r--){var t=l.markerTip.time(u[r]);if(t+.5<e)return void d.currentTime(t)}},add:function(e){t(e)},remove:function(e){y(e)},removeAll:function(){for(var e=[],r=0;r<u.length;r++)e.push(r);y(e)},updateTime:function(e){i(e)},reset:function(e){d.markers.removeAll(),t(e)},destroy:function(){d.markers.removeAll(),s&&s.remove(),f&&f.remove(),d.off("timeupdate",e),delete d.markers}}})});